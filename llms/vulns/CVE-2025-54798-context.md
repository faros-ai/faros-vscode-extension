# CVE-2025-54798: tmp Package Vulnerability

## Vulnerability Overview

**CVE ID:** CVE-2025-54798  
**Severity:** Medium (CVSS 5.3) / Low (CVSS 2.5)  
**Affected Package:** tmp (node.js temporary file and directory creator)  
**Affected Versions:** <= 0.2.3  
**Fixed Version:** >= 0.2.4  
**Published Date:** August 6, 2025  
**Last Modified:** October 9, 2025  
**Ticket Reference:** FAI-17637  
**Due Date:** November 4, 2025

## Vulnerability Description

The tmp package is vulnerable to an arbitrary temporary file/directory write via symbolic link dir parameter. This vulnerability allows attackers to potentially write files to arbitrary locations on the filesystem by exploiting symbolic link handling in the directory parameter.

**CWE Classification:** CWE-59 (Improper Link Resolution Before File Access - 'Link Following')

## Impact Analysis

### Risk Level: Low to Medium (Build-Time Only)

This vulnerability affects the **build and publish pipeline** rather than runtime functionality of the VS Code extension. The tmp package is used exclusively through the `@vscode/vsce` tool, which is a development dependency for packaging and publishing the extension to the VS Code Marketplace.

**Key Impact Points:**
- **Build Environment:** The vulnerability could potentially be exploited during the `npm run package` or `npm run publish` commands
- **CI/CD Pipeline:** Affects the GitHub Actions workflow that builds and publishes the extension
- **Runtime Safety:** Does NOT affect end-user installations or runtime behavior of the extension
- **Scope:** Limited to development and deployment environments, not production user environments

### Attack Scenario

An attacker would need to:
1. Compromise the build environment or CI/CD pipeline
2. Inject malicious symbolic links during the packaging process
3. Exploit the tmp package's improper link resolution

This is a relatively low-probability attack vector but should still be addressed as part of security best practices.

## Dependency Chain Analysis

### Transitive Dependency Path

```
faros-vscode-extension (root)
└── @vscode/vsce@3.1.0 (devDependency)
    └── tmp@0.2.3 (allows ^0.2.3, which resolves to 0.2.5)
```

**Initial State (Before Fix):**
- `@vscode/vsce` version: 3.1.0 (specified in package.json line 151)
- `tmp` version constraint in vsce: `^0.2.3`
- Actual `tmp` version installed: 0.2.5 (already safe)

**Current State (After Fix):**
- `@vscode/vsce` version: 3.6.2 (auto-updated during clean install)
- `tmp` version constraint in vsce: `^0.2.3`
- Actual `tmp` version installed: 0.2.5 (with explicit override)
- npm override enforces: `>=0.2.4`

### Why @vscode/vsce Depends on tmp

The `@vscode/vsce` (Visual Studio Code Extension Manager) tool uses the tmp package to create temporary directories and files during the extension packaging process. This includes:
- Extracting and processing extension files
- Creating temporary build artifacts
- Generating the .vsix package file

## Remediation Steps Taken

### 1. Investigation Phase

We confirmed the dependency chain and verified that:
- The tmp package is indeed a transitive dependency through @vscode/vsce
- The current installed version (0.2.5) was already safe
- Newer versions of @vscode/vsce (up to 3.6.3-0) still specify `tmp: ^0.2.3`

### 2. Remediation Implementation

Added an npm override to package.json following the existing security mitigation pattern:

```json
"overrides": {
  "form-data": "4.0.4",
  "tar-fs": "^3.1.1",
  "tmp": ">=0.2.4"
}
```

This override ensures that:
- Any version of tmp pulled in by any dependency must be >= 0.2.4
- The vulnerability is explicitly mitigated at the package manager level
- Future dependency updates cannot reintroduce vulnerable versions

### 3. Verification

**Testing Performed:**
1. Clean installation: `rm -rf node_modules package-lock.json && npm install`
   - Result: 0 vulnerabilities reported
2. Dependency verification: `npm ls tmp`
   - Result: `tmp@0.2.5 overridden` (confirms override is active)
3. Build testing: `npm run compile`
   - Result: Successful compilation
4. Package testing: `npm run package`
   - Result: Successfully created faros-vscode-extension-0.1.11.vsix

**npm audit Results:**
- Before fix: 3 vulnerabilities (2 low, 1 high) - unrelated to tmp
- After fix: 0 vulnerabilities related to tmp package

## Alternative Solutions Considered

### Option 1: Update @vscode/vsce to Latest Version

**Evaluated:** Checked versions up to 3.6.3-0  
**Result:** All versions still specify `tmp: ^0.2.3`  
**Conclusion:** Updating @vscode/vsce alone does not resolve the issue

The latest @vscode/vsce (3.6.3-0) still has the same tmp dependency constraint, though it resolves to a safe version (0.2.5) due to semantic versioning. However, this doesn't provide explicit protection against future regressions.

### Option 2: npm Override (Selected)

**Advantages:**
- Explicit security enforcement at the package manager level
- Follows existing pattern in the repository (form-data, tar-fs)
- Prevents future regressions from any dependency updates
- Minimal risk and easy to implement
- Works across all dependency depths

**Disadvantages:**
- Requires manual maintenance if tmp package has breaking changes
- Adds another override to track

### Option 3: Wait for @vscode/vsce Update

**Not Selected:** This would leave the codebase vulnerable to potential regressions and doesn't follow security best practices of explicit mitigation.

## Security Context

### Existing Security Mitigations

The repository already implements security overrides for other vulnerabilities:

```json
"overrides": {
  "form-data": "4.0.4",    // Previous security fix
  "tar-fs": "^3.1.1"       // Previous security fix
}
```

This demonstrates that the team has established a pattern of using npm overrides for transitive dependency vulnerabilities, making this remediation consistent with existing security practices.

### Additional Security Recommendations

While addressing this vulnerability, consider:

1. **Dependabot Configuration:** The repository currently lacks a `.github/dependabot.yml` file for automated vulnerability scanning
2. **Package Lock:** Ensure package-lock.json is committed for deterministic builds
3. **Regular Audits:** Schedule periodic `npm audit` reviews as part of the development workflow

## References

- **NVD Entry:** https://nvd.nist.gov/vuln/detail/CVE-2025-54798
- **GitHub Advisory:** https://github.com/raszi/node-tmp/security/advisories/GHSA-52f5-9888-hmc6
- **Fix Commit:** https://github.com/raszi/node-tmp/commit/188b25e529496e37adaf1a1d9dccb40019a08b1b
- **Issue Tracker:** https://github.com/raszi/node-tmp/issues/207

## Conclusion

This vulnerability has been successfully mitigated through an npm override that enforces tmp >= 0.2.4. The fix follows established security patterns in the repository and has been thoroughly tested. The risk was already low due to the build-time-only nature of the dependency, but the explicit override provides defense-in-depth protection against future regressions.

**Status:** ✅ Resolved  
**Verification:** ✅ Tested (npm audit shows 0 vulnerabilities)  
**Impact:** ✅ Minimal (build tooling only, no runtime impact)
